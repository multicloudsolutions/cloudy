TODO
===

* Reduce code duplication
* Write test cases
* Make code more robust
